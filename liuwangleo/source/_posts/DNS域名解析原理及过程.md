---
title: DNS域名解析原理及过程
date: 2021-03-15 12:22:24
tags:
    - DNS域名解析
    - 网络
categories:
    - 计算机网络
cover: https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.taopic.com%2Fuploads%2Fallimg%2F130513%2F240422-1305130F30216.jpg&refer=http%3A%2F%2Fimg.taopic.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1618374397&t=0c801f642fbc728c55bce6c4bd956603
---
# 基本概念
## DNS
`域名系统`（英文：Domain Name System，缩写：DNS）是互联网的一项服务。它作为将`域名`和`IP`地址相互映射的一个`分布式数据库`，能够使人更方便地访问互联网。DNS使用`TCP`和`UDP`端口`53`。当前，对于每一级域名长度的限制是`63`个字符，域名总长度则不能超过`253`个字符。

`域名系统`(Domain Name System,DNS)是Internet上解决网上`机器命名`的一种系统。就像拜访朋友要先知道别人家怎么走一样，Internet上当一台主机要访问另外一台主机时，必须首先获知其地址，`TCP/IP`中的IP地址是由四段以`“.”`分开的数字组成，记起来总是不如名字那么方便，所以，就采用了域名系统来管理名字和IP的对应关系。

更多DNS的讲解，查看[【百度百科】](https://baike.baidu.com/item/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F/2251573?fromtitle=DNS&fromid=427444&fr=aladdin)
## 域名
`域名`（英语：Domain Name），又称网域，是由一串用`点`分隔的名字组成的Internet上某一台计算机或计算机组的名称，用于在数据传输时对计算机的定位标识（有时也指地理位置）。 

由于IP地址具有`不方便记忆`并且`不能显示地址组织`的名称和性质等缺点，人们设计出了`域名`，并通过网域名称系统（DNS，Domain Name System）来将域名和IP地址相互映射，使人更方便地访问互联网，而不用去记住能够被机器直接读取的IP地址数串。 IP地址和域名是一一对应的，这份域名地址的信息存放在一个叫`域名服务器`(DNS，Domain name server)的主机内，使用者只需了解易记的域名地址，其对应转换工作就留给了域名服务器。域名服务器就是提供`IP地址`和`域名`之间的转换服务的服务器。 

**域名入网结构: **
		
		主机名、机构名、网络名、最高层域名 
	
这是一种`分层`的管理模式，域名用文字表达比用数字表示的IP地址容易记忆。加入因特网的各级网络依照域名服务器的命名规则对本网内的计算机命名，并在通信时负责完成域名到各IP地址的转换。域名由两种基本类型组成：`以机构性质命名的域`和`以国家地区代码命名的域`。常见的以机构性质命名的域一般由三个字符组成。

## 域名结构
DNS 系统采用的是分布式的解析方案，整个 DNS 架构是一种层次树状结构，这个树状结构称为 DNS 域名空间，如图：
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210313230940348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NTgxOTYx,size_16,color_FFFFFF,t_70)
树状结构最顶层称为`根域`，用 “.” 表示，相应服务器称为`根服务器`，整个域名空间解析权都归跟服务器所有，但根服务器无法承担庞大的负载，采用“委派”机制，在根域下设置了一些顶级域，然后将不同顶级域解析权分别委派给相应的顶级域服务器，如将 com 域 的解析全委派给 com 域服务器，以后但凡跟服务器收到以 com 结尾的域名解析请求，都会转发给com 域服务器，同样道理，为了减轻顶级域的压力，又下设了若干二级域，二级域又下设三级域或主机
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210313231047859.png)
- 根域
位于域名空间最顶层，一般用一个 “.” 表示
- 顶级域
一般代表一种类型的组织机构或国家地区，如 net、com、org、edu、gov、mil、cn、jp、hk
- 二级域
用来标明顶级域内的一个特定的组织，国家顶级域下面的二级域名由国家网络部门统一管理，如 .cn 顶级域名下面设置的二级域名：.com.cn、.net.cn、.edu.cn …
- 子域
二级域下所创建的各级域统称为子域，各个组织或用户可以自由申请注册自己的域名
- 主机
主机位于域名空间最下层，就是一台具体的计算机，如 www、mail、都是具体的计算机名字，可用www.sina.com.cn.、mail.sina.com.cn. 来表示，这种表示方式称为 FQDN (完全合格域名)，也是这台主机在域名中的全名

# DNS记录
转载这篇，详情点击查看[https://www.cnblogs.com/alummox/p/11173460.html](https://www.cnblogs.com/alummox/p/11173460.html)

# DNS域名解析过程
 域名解析总体可分为一下过程：
(1) 输入域名后, 先查找自己主机对应的域名服务器，域名服务器先查找自己的数据库中的数据.
(2) 如果没有， 就向上级域名服务器进行查找， 依次类推
(3) 最多回溯到根域名服务器, 肯定能找到这个域名的IP地址
(4) 域名服务器自身也会进行一些缓存， 把曾经访问过的域名和对应的IP地址缓存起来, 可以加速查找过程

**DNS服务的工作过程**
当 DNS 客户机需要查询程序中使用的名称时，它会查询本地DNS 服务器来解析该名称。客户机发送的每条查询消息都包括3条信息，以指定服务器应回答的问题。
- 指定的 DNS 域名，表示为完全合格的域名 (FQDN) 。
- 指定的查询类型，它可根据类型指定资源记录，或作为查询操作的专门类型。
-  DNS域名的指定类别。

对于DNS 服务器，它始终应指定为 Internet 类别。例如，指定的名称可以是计算机的完全合格的域名，并且指定的查询类型用于通过该名称搜索地址资源记录。

DNS 查询以各种不同的方式进行解析。客户机有时也可通过使用从以前查询获得的缓存信息就地应答查询。DNS 服务器可使用其自身的资源记录信息缓存来应答查询，也可代表请求客户机来查询或联系其他 DNS 服务器，以完全解析该名称，并随后将应答返回至客户机。这个过程称为递归。

另外，客户机自己也可尝试联系其他的 DNS 服务器来解析名称。如果客户机这么做，它会使用基于服务器应答的独立和附加的查询，该过程称作迭代，即DNS服务器之间的交互查询就是迭代查询。

**DNS 查询的过程如下图所示**
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210314002822828.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NTgxOTYx,size_16,color_FFFFFF,t_70)
`具体过程可描述如下：`
1. `主机`先向`本地域名服务器`进行`递归查询`
2. 本地域名服务器采用`迭代查询`，向一个`根域名服务器`进行查询
3. `根域名服务器`告诉本地域名服务器，下一次应该查询的`顶级域名服务器`的IP地址
4. 本地域名服务器向`顶级域名服务`器进行查询
5. 顶级域名服务器告诉本地域名服务器，下一步查询`权限服务器`的IP地址
6. 本地域名服务器向`权限服务器`进行查询
7. 权限服务器告诉`本地域名服务器`所查询的主机的IP地址
8. 本地域名服务器最后把`查询结果`告诉`主机`

> 上文我们提出了两个概念：`递归查询`和`迭代查询`
（1）**递归查询：** 本机向本地域名服务器发出一次查询请求，就静待最终的结果。如果本地域名服务器无法解析，自己会以DNS客户机的身份向其它域名服务器查询，直到得到最终的IP地址告诉本机
>（2）**迭代查询：** 本地域名服务器向根域名服务器查询，根域名服务器告诉它下一步到哪里去查询，然后它再去查，每次它都是以客户机的身份去各个服务器查询。

通俗地说，`递归`就是把一件事情交给别人，如果事情没有办完，哪怕已经办了很多，都不要把结果告诉我，我要的是你的最终结果，而不是中间结果；如果你没办完，请你找别人办完。
`迭代`则是我交给你一件事，你能办多少就告诉我你办了多少，然后剩下的事情就由我来办。

**解析顺序**
- 浏览器缓存
	当用户通过浏览器访问某域名时，浏览器首先会在自己的缓存中查找是否有该域名对应的IP地址（若曾经访问过该域名且没有清空缓存便存在）
-  系统缓存
 	当浏览器缓存中无域名对应IP则会自动检查用户计算机系统Hosts文件DNS缓存是否有该域名对应IP；
- 路由器缓存
	当浏览器及系统缓存中均无域名对应IP则进入路由器缓存中检查，以上三步均为客服端的DNS缓存；
- ISP（互联网服务提供商）DNS缓存
	当在用户客服端查找不到域名对应IP地址，则将进入ISP DNS缓存中进行查询。比如你用的是电信的网络，则会进入电信的DNS缓存服务器中进行查找；
-  根域名服务器
	当以上均未完成，则进入根服务器进行查询。全球仅有13台根域名服务器，1个主根域名服务器，其余12为辅根域名服务器。根域名收到请求后会查看区域文件记录，若无则将其管辖范围内顶级域名（如.com）服务器IP告诉本地DNS服务器；
-  顶级域名服务器
	顶级域名服务器收到请求后查看区域文件记录，若无则将其管辖范围内主域名服务器的IP地址告诉本地DNS服务器；
- 主域名服务器
	主域名服务器接受到请求后查询自己的缓存，如果没有则进入下一级域名服务器进行查找，并重复该步骤直至找到正确纪录；
- 保存结果至缓存
	本地域名服务器把返回的结果保存到缓存，以备下一次使用，同时将该结果反馈给客户端，客户端通过这个IP地址与web服务器建立链接。